(window.webpackJsonp=window.webpackJsonp||[]).push([[12],{568:function(s,n,a){"use strict";a.r(n);var e=a(4),t=Object(e.a)({},(function(){var s=this,n=s.$createElement,a=s._self._c||n;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h2",{attrs:{id:"服务端渲染与vue项目的服务端渲染优化"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#服务端渲染与vue项目的服务端渲染优化"}},[s._v("#")]),s._v(" 服务端渲染与vue项目的服务端渲染优化")]),s._v(" "),a("p",[s._v("文章首先带大家认识什么是服务端渲染以及常见的前端服务端渲染框架，然后再围绕服务端渲染如何与vue\n搭配使用，大家一起来看看吧。")]),s._v(" "),a("h3",{attrs:{id:"什么是服务端渲染"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#什么是服务端渲染"}},[s._v("#")]),s._v(" 什么是服务端渲染")]),s._v(" "),a("blockquote",[a("p",[s._v('简单理解是将组件或页面通过服务器生成html字符串，再发送到浏览器，最后将静态标记"混合"为客户端上完全交互的应用程序。')])]),s._v(" "),a("ul",[a("li",[s._v("传统"),a("code",[s._v("PHP、JSP、ASP")]),s._v("的模版渲染")]),s._v(" "),a("li",[s._v("前端"),a("code",[s._v("Express、Koa、Egg")]),s._v("等基于"),a("code",[s._v("Node.js")]),s._v("的"),a("code",[s._v("MVC")]),s._v("框架")]),s._v(" "),a("li",[a("code",[s._v("React、Vue")]),s._v("的同构框架")])]),s._v(" "),a("h3",{attrs:{id:"关于express-koa-egg"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#关于express-koa-egg"}},[s._v("#")]),s._v(" 关于"),a("code",[s._v("Express & Koa & Egg")])]),s._v(" "),a("ul",[a("li",[a("code",[s._v("Express")]),s._v(" -- "),a("a",{attrs:{href:"https://www.expressjs.com.cn/",target:"_blank",rel:"noopener noreferrer"}},[s._v("基于 Node.js 平台，快速、开放、极简的 Web 开发框架"),a("OutboundLink")],1)]),s._v(" "),a("li",[a("code",[s._v("Koa")]),s._v("-- "),a("a",{attrs:{href:"https://koa.bootcss.com/",target:"_blank",rel:"noopener noreferrer"}},[s._v("基于 Node.js 平台的下一代 web 开发框架"),a("OutboundLink")],1)]),s._v(" "),a("li",[a("code",[s._v("Egg")]),s._v("-- "),a("a",{attrs:{href:"https://eggjs.org/zh-cn/",target:"_blank",rel:"noopener noreferrer"}},[s._v("为企业级框架和应用而生"),a("OutboundLink")],1)])]),s._v(" "),a("h3",{attrs:{id:"快速上手koa2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#快速上手koa2"}},[s._v("#")]),s._v(" 快速上手"),a("code",[s._v("Koa2")])]),s._v(" "),a("blockquote",[a("p",[a("code",[s._v("koa2")]),s._v("与"),a("code",[s._v("koa1")]),s._v("的最大区别是"),a("code",[s._v("koa2")]),s._v("实现异步是通过"),a("code",[s._v("async/await")]),s._v("，"),a("code",[s._v("koa1")]),s._v("实现异步是通过"),a("code",[s._v("generator/yield")]),s._v("，而"),a("code",[s._v("express")]),s._v("实现异步是通过回调函数的方式。")])]),s._v(" "),a("h5",{attrs:{id:"学习目标"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#学习目标"}},[s._v("#")]),s._v(" 学习目标：")]),s._v(" "),a("ul",[a("li",[s._v("快速搭建服务")]),s._v(" "),a("li",[s._v("理解洋葱模型\n"),a("img",{attrs:{src:"https://upload-images.jianshu.io/upload_images/9566895-a1d3c5a8db4a088d.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/540/format/webp",alt:"image"}})]),s._v(" "),a("li",[a("code",[s._v("koa+pug")]),s._v("服务端渲染的简单实现")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("app.use(views(resolve(__dirname,'../views'), {\n    extension: 'pug'\n}));\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("h3",{attrs:{id:"我们的服务端渲染实践"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#我们的服务端渲染实践"}},[s._v("#")]),s._v(" 我们的服务端渲染实践")]),s._v(" "),a("ol",[a("li",[s._v("从"),a("code",[s._v("Express + Jade")]),s._v("框架开始前后端分离。")]),s._v(" "),a("li",[s._v("从服务端渲染转到浏览器渲染（"),a("code",[s._v("Vue")]),s._v("）框架。")])]),s._v(" "),a("h5",{attrs:{id:"express转vue的几点原因"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#express转vue的几点原因"}},[s._v("#")]),s._v(" "),a("code",[s._v("Express")]),s._v("转"),a("code",[s._v("Vue")]),s._v("的几点原因：")]),s._v(" "),a("ul",[a("li",[a("code",[s._v("Express")]),s._v("比较吃服务器")]),s._v(" "),a("li",[a("code",[s._v("Express")]),s._v("项目前端页面与服务端耦合度高，服务挂掉会影响全局")]),s._v(" "),a("li",[a("code",[s._v("Express")]),s._v("开发调试不方便，数据问题排除依赖日志")]),s._v(" "),a("li",[a("code",[s._v("Vue")]),s._v("组件化效果更好，数据驱动")])]),s._v(" "),a("p",[s._v("服务端渲染完败？？？")]),s._v(" "),a("h3",{attrs:{id:"客户端渲染-csr-的不足"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#客户端渲染-csr-的不足"}},[s._v("#")]),s._v(" 客户端渲染（CSR）的不足")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://pic4.zhimg.com/v2-e57abf968b4b3349e3d77459ced41b53_1440w.jpg?source=172ae18b",alt:"image"}})]),s._v(" "),a("h5",{attrs:{id:"_1-seo能力不足"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-seo能力不足"}},[s._v("#")]),s._v(" 1.SEO能力不足")]),s._v(" "),a("p",[s._v("虽然Google开始通过爬虫技术直接从js里面抓取关键字，但是实际效果依然与使用SSR页面有着明显的差距。")]),s._v(" "),a("p",[s._v("国外一个技术博客"),a("code",[s._v("Spectrum")]),s._v("的开发者之一"),a("code",[s._v("Max Stoiber")]),s._v(",也是 "),a("code",[s._v("styled-components")]),s._v(" 的作者，在分享网站搭建历程时说，后悔刚开始没有采用"),a("code",[s._v("Next.js")]),s._v("。他们在九月引入SSR后，网站收录有了质的影响。")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://statics.lotsmall.cn/image/20201103/20201103235501kvcxq4.jpeg",alt:"image"}})]),s._v(" "),a("h5",{attrs:{id:"_2-首次加载白屏-加载慢"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-首次加载白屏-加载慢"}},[s._v("#")]),s._v(" 2.首次加载白屏，加载慢")]),s._v(" "),a("p",[s._v("目前在我们项目中也有类似的问题，打包的主js比较大，纯浏览器渲染需要等待js加载完之后，才开始页面渲染。")]),s._v(" "),a("p",[s._v("哔哩哔哩（B站）的前端之路 - Crazy-吴俊毅的文章 - "),a("a",{attrs:{href:"https://zhuanlan.zhihu.com/p/32487533",target:"_blank",rel:"noopener noreferrer"}},[s._v("知乎地址"),a("OutboundLink")],1)]),s._v(" "),a("h5",{attrs:{id:"如何优化"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#如何优化"}},[s._v("#")]),s._v(" 如何优化")]),s._v(" "),a("ul",[a("li",[s._v("使用"),a("code",[s._v("vue-server-render")]),s._v(",  "),a("a",{attrs:{href:"https://ssr.vuejs.org/zh/guide/",target:"_blank",rel:"noopener noreferrer"}},[s._v("官方Vue-SSR指南"),a("OutboundLink")],1)]),s._v(" "),a("li",[s._v("使用"),a("code",[s._v("prerender-spa-plugin")]),s._v("预渲染，"),a("a",{attrs:{href:"https://github.com/chrisvfritz/prerender-spa-plugin",target:"_blank",rel:"noopener noreferrer"}},[s._v("Git地址"),a("OutboundLink")],1)])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("// Basic Usage\nconst path = require('path')\nconst PrerenderSPAPlugin = require('prerender-spa-plugin')\n\nmodule.exports = {\n  plugins: [\n    ...\n    new PrerenderSPAPlugin({\n      // Required - The path to the webpack-outputted app to prerender.\n      staticDir: path.join(__dirname, 'dist'),\n      // Required - Routes to render.\n      routes: [ '/', '/about', '/some/deep/nested/route' ],\n    })\n  ]\n}\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br")])]),a("ul",[a("li",[s._v("同构渲染")])]),s._v(" "),a("h3",{attrs:{id:"同构渲染之nuxt"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#同构渲染之nuxt"}},[s._v("#")]),s._v(" 同构渲染之"),a("code",[s._v("Nuxt")])]),s._v(" "),a("blockquote",[a("p",[s._v("来自Vue官网大评价：\n从头搭建一个服务端渲染的应用是相当复杂的。幸运的是，我们有一个优秀的社区项目 Nuxt.js 让这一切变得非常简单。Nuxt 是一个基于 Vue 生态的更高层的框架，为开发服务端渲染的 Vue 应用提供了极其便利的开发体验。更酷的是，你甚至可以用它来做为静态站生成器。推荐尝试。")])]),s._v(" "),a("p",[s._v("附："),a("a",{attrs:{href:"https://www.nuxtjs.cn/",target:"_blank",rel:"noopener noreferrer"}},[s._v("nuxt中文文档"),a("OutboundLink")],1)]),s._v(" "),a("p",[s._v("实战项目分析："),a("code",[s._v("Nuxt + ZanUI")])]),s._v(" "),a("h5",{attrs:{id:"如何新增插件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#如何新增插件"}},[s._v("#")]),s._v(" 如何新增插件")]),s._v(" "),a("ul",[a("li",[s._v("使用第三方模块")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("npm install --save axios\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("<template>\n  <h1>{{ title }}</h1>\n</template>\n\n<script>\n  import axios from 'axios'\n\n  export default {\n    async asyncData({ params }) {\n      let { data } = await axios.get(`https://my-api/posts/${params.id}`)\n      return { title: data.title }\n    }\n  }\n<\/script>\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br")])]),a("ul",[a("li",[s._v("直接使用链接")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("head: {\n    link: [\n      {\n        rel: 'stylesheet',\n        href: '//at.alicdn.com/t/font_1985456_2ushr2u1y69.css',\n      },\n    ],\n    script: [\n      {src: 'https://webapi.amap.com/maps', async: true},\n    ],\n  },\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br")])]),a("ul",[a("li",[s._v("使用 Vue 插件")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("~/plugins/ui.js\n\nimport Vue from 'vue'\nimport Element from 'element-ui'\nimport locale from 'element-ui/lib/locale/lang/zh-CN'\n\nVue.use(Element, { locale })\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])]),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("~/nuxt.config.js\n\nplugins: [\n    { src: '~/plugins/ui.js', ssr: true },\n  ],\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("ul",[a("li",[s._v("注入 Vue 实例")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("~/plugins/vue-inject.js\n\nimport Vue from 'vue'\n\nVue.prototype.$myInjectedFunction = string =>\n  console.log('This is an example', string)\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("~/nuxt.config.js\n\nexport default {\n  plugins: ['~/plugins/vue-inject.js']\n}\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("ul",[a("li",[s._v("注入 context")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("~/plugins/ctx-inject.js\n\nexport default ({ app }, inject) => {\n  // Set the function directly on the context.app object\n  app.myInjectedFunction = string =>\n    console.log('Okay, another function', string)\n}\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])]),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("~/nuxt.config.js\nexport default {\n  plugins: ['~/plugins/ctx-inject.js']\n}\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("ul",[a("li",[s._v("同时注入")])]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("// 引入@nuxtjs/axios 添加到 module\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("...\n// 注册服务\nconst extendAxiosInstance = axios => {\n  const axiosModules = <%= serialize(options.axios.modules) %>\n\n  if (axiosModules) {\n    const keys = Object.keys(axiosModules);\n    for (let module of keys) {\n      // Request helpers ($get, $post, ...)\n      axios['$' + module] = {}\n      for (let method of ['request', 'delete', 'get', 'head', 'options', 'post', 'put', 'patch']) {\n        axios['$' + module][method] = function() {\n          if (arguments.length > 0) {\n            ...\n          }\n          return axios[method].apply(axios, arguments)\n        }\n      }\n    }\n  }\n}\n\n\nfunction AxiosFunction(content) {\n  const indexAxios = content.app.$axios;\n  extendAxiosInstance(indexAxios)\n  ...\n  // 请求拦截\n  indexAxios.interceptors.request.use(function(config) {\n    ...\n    return config;\n  });\n\n\n  // 响应拦截器\n  indexAxios.interceptors.response.use(response => new Promise((resolve, reject) => {\n    ....\n    resolve(data.data);\n  }), error => {\n    //关闭加载\n    close(error.config);\n    const resultData = {}\n    ...\n    return Promise.reject(resultData)\n  });\n\n  // 自定义拦截器\n  const interceptors = <%= serialize(options.axios.interceptors) %>\n  if (interceptors) {\n    interceptors.forEach(config => {\n      ...\n    })\n  }\n\n  return indexAxios;\n}\n\n// 同时注入\nexport default (content, inject) => {\n  inject('http', AxiosFunction(content))\n}\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br"),a("span",{staticClass:"line-number"},[s._v("42")]),a("br"),a("span",{staticClass:"line-number"},[s._v("43")]),a("br"),a("span",{staticClass:"line-number"},[s._v("44")]),a("br"),a("span",{staticClass:"line-number"},[s._v("45")]),a("br"),a("span",{staticClass:"line-number"},[s._v("46")]),a("br"),a("span",{staticClass:"line-number"},[s._v("47")]),a("br"),a("span",{staticClass:"line-number"},[s._v("48")]),a("br"),a("span",{staticClass:"line-number"},[s._v("49")]),a("br"),a("span",{staticClass:"line-number"},[s._v("50")]),a("br"),a("span",{staticClass:"line-number"},[s._v("51")]),a("br"),a("span",{staticClass:"line-number"},[s._v("52")]),a("br"),a("span",{staticClass:"line-number"},[s._v("53")]),a("br"),a("span",{staticClass:"line-number"},[s._v("54")]),a("br"),a("span",{staticClass:"line-number"},[s._v("55")]),a("br"),a("span",{staticClass:"line-number"},[s._v("56")]),a("br"),a("span",{staticClass:"line-number"},[s._v("57")]),a("br"),a("span",{staticClass:"line-number"},[s._v("58")]),a("br"),a("span",{staticClass:"line-number"},[s._v("59")]),a("br"),a("span",{staticClass:"line-number"},[s._v("60")]),a("br"),a("span",{staticClass:"line-number"},[s._v("61")]),a("br"),a("span",{staticClass:"line-number"},[s._v("62")]),a("br")])]),a("h5",{attrs:{id:"服务端获取数据"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#服务端获取数据"}},[s._v("#")]),s._v(" 服务端获取数据")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("asyncData ({isDev, route, store, env, params, query, req, res, redirect, error}) {\n    const detailDate = await $http.get(parkProductDetail + params.id);\n    const picLab = detailDate.wapPictureLib;\n    if (detailDate.flashUrl) {\n      picLab.unshift({\n        type: 'video',\n        url: detailDate.flashUrl,\n        cover: ' ',\n      });\n    }\n    return { parkInfo: detailDate, parkId: params.id, picLab };\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br")])]),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v(" fetch({ store, params }) {\n    const detailDate = await $http.get(parkProductDetail + params.id);\n    store.commit('setDetail', detailDate)\n })    \n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("h5",{attrs:{id:"store的使用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#store的使用"}},[s._v("#")]),s._v(" Store的使用")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("~/store/mdse.js\n\nimport vm from 'vue';\n\nexport const state = () => ({\n  orderInfo: {}, // 缓存下单数据\n});\n\nexport const getters = {\n  getOrderInfo(_state) {\n    return _state.orderInfo;\n  },\n};\n\nexport const mutations = {\n  // 更新下单信息\n  updateOrderInfo(_state, info) {\n    vm.set(_state, 'orderInfo', info);\n  },\n};\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br")])]),a("h5",{attrs:{id:"node中间件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#node中间件"}},[s._v("#")]),s._v(" node中间件")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("~/middleware/auth.js\n\n/**\n * 拦截登录\n */\n\nexport default async ({ store, route: { path, fullPath }, redirect }) => {\n  // 商户端\n  if (path.startsWith('/merchant')) {\n    const ignoreMerchantCatchPath = [\n      '/merchant',\n      ....\n    ];\n\n    if (\n      !ignoreMerchantCatchPath.includes(path) &&\n      !store.getters['user/isMerchantLogin']\n    ) {\n      redirect(`/merchant/login/shop?redirect=${encodeURIComponent(fullPath)}`);\n      return;\n    }\n    return;\n  } else {\n    await store.dispatch('getProjectInfo');\n    // 核销二维码地址\n    if (path.indexOf('/t/') >= 0) {\n      return;\n    }\n\n    // 忽略校验登录地址\n    const ignoreCatchPath = [\n      '/',\n      '/login',\n      '/login/registry',\n      ....\n    ];\n\n    if (\n      !(\n        ignoreCatchPath.includes(path) ||\n        path.indexOf('/detail/') !== -1 ||\n        path.indexOf('/group/') !== -1\n      ) &&\n      !store.getters['user/isLogin']\n    ) {\n      redirect(`/login?redirect=${encodeURIComponent(fullPath)}`);\n      return;\n    }\n  }\n};\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br"),a("span",{staticClass:"line-number"},[s._v("42")]),a("br"),a("span",{staticClass:"line-number"},[s._v("43")]),a("br"),a("span",{staticClass:"line-number"},[s._v("44")]),a("br"),a("span",{staticClass:"line-number"},[s._v("45")]),a("br"),a("span",{staticClass:"line-number"},[s._v("46")]),a("br"),a("span",{staticClass:"line-number"},[s._v("47")]),a("br"),a("span",{staticClass:"line-number"},[s._v("48")]),a("br"),a("span",{staticClass:"line-number"},[s._v("49")]),a("br"),a("span",{staticClass:"line-number"},[s._v("50")]),a("br"),a("span",{staticClass:"line-number"},[s._v("51")]),a("br")])]),a("h5",{attrs:{id:"打包与部署"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#打包与部署"}},[s._v("#")]),s._v(" 打包与部署")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("npm install\nnpm run build\n\npm2 start ./ecosystem.config.js\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("~/ecosystem.config.js\n\nmodule.exports = {\n  apps: [\n    {\n      name: 'cqyjy-mall-mobile-ui',\n      script: 'npm start',\n      log_date_format: 'YYYY-MM-DD HH:mm:ss',\n      error_file: './logs/app-err.log',\n      out_file: './logs/app-out.log',\n    },\n  ],\n};\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br")])])])}),[],!1,null,null,null);n.default=t.exports}}]);